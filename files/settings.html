<html>

<head>
  <title>Settings</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="root">
    <form method="post" id="settings">
      <div>
        <label>
          SSID<input type="text" name="SSID" value="%s" placeholder="SSID">
        </label>
      </div>
      <div>
        <label>
          PASSWORD<input type="text" name="PWD" value="%s" placeholder="PASSWORD">
        </label>
      </div>
      <input id="submit" type="button" value="Send">
      </form>
  </div>
  <input id="resetWifi" type="button" value="Reset Wifi"> <a href="/"><input type="button" value="To controls"></a>
</body>
<script>
  document.getElementById('resetWifi').addEventListener('click', () => fetch('rersetwifi'));
  const credsRespParser = resp => {
    resp.split('\n').forEach(row => {
      row = row.split('=');
      if(row[0] === 'SSID') {
        form[0].value = row[1];
      } else if (row[0] === 'PWD') {
        form[1].value = row[1];
      }
    });
  }
  const form = document.getElementById("settings");
  fetch('/settingsstate').then(resp => resp.text()).then(credsRespParser);
  document.getElementById("submit").addEventListener('click', () => {
    const data = `SSID=${form[0].value}
PWD=${form[1].value}`
    console.log(data)
    fetch('/wifiset', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: data,
    }).then(resp => resp.text()).then(credsRespParser);
  }
  );
</script>

</html>